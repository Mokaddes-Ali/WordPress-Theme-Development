<!-- Comment Section -->
<div class="comments">
  <?php
  $get_comment_count = get_comments_number();
  if ($get_comment_count > 0):
    echo '<h3>Comments: (' . esc_html($get_comment_count) . ')</h3>';
    echo '<div class="divider"></div>';
  endif;

  $comments = get_comments([
    'post_id' => get_the_ID(),
    'status' => 'approve',
    'orderby' => 'comment_date',
    'order' => 'ASC',
  ]);

   function render_comments($comments, $parent = 0, $depth = 0) {
    foreach ($comments as $comment) {
      if ((int)$comment->comment_parent === (int)$parent) {
        ?>
      <div class="comment-item <?php echo $parent > 0 ? 'reply depth-' . $depth : ''; ?>" id="comment-<?php echo $comment->comment_ID; ?>">
          <?php echo get_avatar($comment, 50); ?>
          <div class="comment-content">
            <div class="comment-header">
              <strong><?php echo esc_html($comment->comment_author); ?></strong>
              <span class="time"><?php echo esc_html(human_time_diff(strtotime($comment->comment_date), current_time('timestamp'))) ?> ago</span>
            </div>
            <p><?php echo esc_html($comment->comment_content); ?></p>

            <button class="reply-btn" data-comment-id="<?php echo $comment->comment_ID; ?>">Reply</button>
            <div class="reply-form-container" id="reply-form-<?php echo $comment->comment_ID; ?>"></div>

            <?php render_comments($comments, $comment->comment_ID, $depth + 1); ?>
          </div>
        </div>
        <?php
      }
    }
  }

  if ($comments) {
    echo '<div class="comment-list">';
    render_comments($comments);
    echo '</div>';
  }
  ?>
</div>

<!-- Hidden Reply Form Template -->
<div id="hidden-reply-form" style="display: none;">
  <form action="<?php echo site_url('/wp-comments-post.php'); ?>" method="post" class="reply-form">
    <input type="text" name="author" placeholder="Your Name" required />
    <input type="email" name="email" placeholder="Your Email" required />
    <textarea name="comment" rows="4" placeholder="Your Reply" required></textarea>
    <input type="hidden" name="comment_post_ID" value="<?php echo get_the_ID(); ?>" />
    <input type="hidden" name="comment_parent" value="0" class="comment_parent_input" />
    <button type="submit">Submit Reply</button>
  </form>
</div>